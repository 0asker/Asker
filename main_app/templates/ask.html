{% load main_app_extras %}
<!doctype html>
<html lang="pt-br">
<head>
<title>Perguntar</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="asker, asker.fun, perguntar">
<meta name="description" content="Faça uma pergunta no Asker.fun">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
<script src="/static/js/cookieman.js?v=1"></script>
<script>
	if (getDarkCookie() == 'true') {
		var cssversion = '?v=1.0';
		var cssfn = 'ask-d.css';
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = '/static/css/' + cssfn + cssversion;
		document.head.appendChild(link);
	}
</script>
<style>
.form-control {
    border: 1px solid rgba(0,0,0,.125);
}
.form-group * {
	margin-top: 5px;
}
main {
	width: 50%;
	margin: 5px auto;
}
.smallbtn {
  color: black;
  cursor: pointer;
}
.smallbtn:hover {
  color: black;
  text-decoration: underline;
}
#button-container {
  margin-bottom: 10px;
  margin-top: 10px;
}
#poll-box {
  margin-bottom: 10px;
}
@media (min-width: 320px) and (max-width: 480px) {
	main {
		width: 80%;
	}
}
</style>
<script>function format_form(e){"?"!=e.question.value[e.question.value.length-1]&&(e.question.value+="?")}</script>
</head>
<body>
	<main>
		{% if user_p.active %}
		<div id="inner">
			<form method="post" enctype="multipart/form-data" onsubmit="format_form(this)">
				{% csrf_token %}
				<div class="form-group">
					<input class="form-control" type="text" name="question" placeholder="Sua pergunta aqui" autocomplete="off" maxlength="180">
					<textarea maxlength="5000" class="form-control" placeholder="Descrição (opcional)" name="description"></textarea>
					<label for="image">Imagem</label>
					<input type="file" class="form-control-file" id="image" name="file" onclick="return veracity_test({{ user_p.total_points }}, {% MINIMUM_POINTS_FOR_POSTING_IMAGES %});">

					<div id="button-container"><a href="#" class="smallbtn" onclick="togglePoll();">Incluir enquete</a></div>

					<div class="card" id="poll-box" style="display: none;"><div class="card-body">
						<input id="choices-counter" type="hidden" name="choices-count" value="0">
						<input type="checkbox" name="is-multichoice" id="is-multichoice"> <label for="is-multichoice"> Permitir múltiplas escolhas </label>
						<div id="poll-choices">
							<div class="poll-choice" id="choice-1">
								<span>Opção 1:</span>
								<br>
								<input class="form-control poll-choice-text" type="text" name="choice-1" autocomplete="off" maxlength="60">
							</div>

							<div class="poll-choice" id="choice-2">
								<span>Opção 2:</span>
								<br>
								<input class="form-control poll-choice-text" type="text" name="choice-2" autocomplete="off" maxlength="60">
							</div>
						</div>

						<a href="#" class="smallbtn" style="float:left;" onclick="addPollChoice();"> Mais </a>
						<a href="#" class="smallbtn" style="float:right;" onclick="removePollChoice();"> Remover </a>

					</div></div>

					<input class="btn btn-primary" type="submit" value="Fazer pergunta">
				</div>
			</form>
		</div>
		<hr>
		<footer>
			<p>Encontrou algum bug, tem alguma dúvida ou sugestão? <a href="mailto:minha.ccontta@gmail.com">Me envie um email</a>.</p>
		</footer>
{{ error|safe }}
{% else %}
<div class="alert alert-info"><p>Confirme seu email abrindo o link enviado para ele.<br>Este é o email usado na tela de cadastro: {{ user.email }}</p><p>Caso não encontre o email, verifique na pasta de spam.</p></div>
{% endif %}
	</main>
<script>
	var pollChoices = 2;

	function addPollChoice() {
		if (pollChoices == 12) { return 0; }
		pollChoices += 1;
		var choicesDiv = document.getElementById('poll-choices');

		var newChoiceDiv = document.createElement('div');
		newChoiceDiv.class = 'poll-choice';
		newChoiceDiv.id = 'choice-' + pollChoices;
		newChoiceDiv.innerHTML += '<span>Opção '+ pollChoices +':</span><br><input class="form-control poll-choice-text" type="text" name="choice-'+ pollChoices +'" autocomplete="off" maxlength="60" required>';
		choicesDiv.appendChild(newChoiceDiv);

		document.getElementById('choices-counter').value = pollChoices;
	}

	function removePollChoice() {
		if (pollChoices == 2) { return 0; }
		let choiceDiv = document.getElementById('choice-' + pollChoices);
		choiceDiv.remove();
		pollChoices -= 1;
		document.getElementById('choices-counter').value = pollChoices;
	}

	function togglePoll() {
		let counter = document.getElementById('choices-counter');
		let pollBox = document.getElementById('poll-box');
		let pollChoicesTexts = document.getElementsByClassName('poll-choice-text');
		if (counter.value == 0) {
			pollBox.style = 'display: flex;';
			counter.value = pollChoices;
			for (var i = 0; i < pollChoicesTexts.length; i++) {
				pollChoicesTexts[i].required = true;
			}
		} else {
			pollBox.style = 'display: none;';
			counter.value = 0;
			for (var i = 0; i < pollChoicesTexts.length; i++) {
				pollChoicesTexts[i].required = false;
			}
		}
	}
</script>
<script src="/static/js/general_functions.js?version=2"></script>
</body>
</html>
