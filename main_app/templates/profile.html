{% load main_app_extras %}
{% load humanize %}
<!doctype html>
<html lang="pt-br">{% if user.username == "Erick" %} {{ user_p.total_views }} visualiza√ß√µes {% endif %}
	<head>
		<title>{{user_p.user.username}}</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
		<link href="https://fonts.googleapis.com/css?family=Raleway:400,500,500i,700,800i" rel="stylesheet">
		<script src="/static/js/cookieman.js?v=1"></script>
		<script>
			var cssfn = 'profile.css';
			var cssversion = '?v=4';
			if (getDarkCookie() == 'true') { cssfn = 'profile-d.css';}
			var link = document.createElement('link');
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = '/static/css/' + cssfn + cssversion;
			document.head.appendChild(link);
		</script>
		<script src="https://kit.fontawesome.com/1f965a8b94.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

		<script type="text/javascript">
			$(document).ready(function() {
				$('.navbar-light .dmenu').hover(function() {
					$(this).find('.sm-menu').first().stop(true, true).slideDown(150);
				}, function() {
					$(this).find('.sm-menu').first().stop(true, true).slideUp(105)
				});
			});
		</script>
		<style>
			#responses-section {
				width: 50%;
			}

			#questions-section {
				width: 50%;
			}

			#center1 img {
				max-width: 30vw;
				max-height: 40vh;
				display: block;
			}

			#bio {
				width: 50%;
			}

            .table {
                width: 50%;
                margin: 0 auto;
            }

            #tabs {
				width: 48%;
				margin: auto;
			}

			#edit-profile, #questions-section, #responses-section, #uinfo {
				width: 50%;
				margin: auto;
			}

			@media (min-width: 320px) and (max-width: 480px) {
				#edit-profile {
					width: 95%;
					margin-top: 10px;
					margin-bottom: 10px;
				}

				#tabs {
					width: 94%;
				}
				.table {
				    width: 98%;
				}

				#bio {
					width: 90%;
				}

				#responses-section, #questions-section, #uinfo {
					width: 95%;
				}
				#qs, #rs {
					width: 100%;
				}
				.question.card-body, .response.card-body {
					padding-left: 0px;
					padding-right: 0px;
				}
			}
		</style>
	</head>
	<body>
		<nav class="navbar navbar-expand-sm navbar-light">
		    <a href="/" class="navbar-brand"><img src="/static/images/asker.png" height="40px" alt="Asker"></a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarTogglerDemo03">
				<ul class="navbar-nav mr-auto mt-2 mt-lg-0">
					{% if user.is_authenticated %}
    					{% if user.username != user_p.user.username %}
    					<li class="nav-item">
    					    <a class="nav-link" href="/user/{{user.username}}"><i class="far fa-user"></i> perfil</a>
    					</li>
    					{% endif %}
					<li class="nav-item">
						<a class="nav-link" href="/ask"><i class="fas fa-question"></i> perguntar</a>
					</li>
					<li class="nav-item">
					    <a class="nav-link" href="/notifications"><i class="far fa-bell"></i> notifica√ß√µes</a>
					</li>
					<li class="nav-item">
					    <a class="nav-link" href="/rank"><i class="fas fa-trophy"></i> rank</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/logout"><i class="fas fa-external-link-alt"></i> sair</a>
					</li>
					{% else %}
					<li class="nav-item">
						<a class="nav-link" href="/signin">Entrar</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/signup">Criar uma conta</a>
					</li>
					{% endif %}
				</ul>
			</div>
		</nav><main><div class="card bg-main" id="uinfo"><div class="card-body">
		<center id="center1">
		    <img src="{{user_p.avatar.url}}" alt="{{user_p.user.username}}"> <span>{{ user_p.user.username }}</span>
			{% if user_p.user.username == "Erick" %}<p id="bio">{{ user_p.bio|safe }}</p>{% else %}
			<p id="bio">{{ user_p.bio }}</p>{% endif %}
		</center>
		<div class="card-group">
			<div class="card bg-inner">
				<div class="card-body">
					<h4>Perguntas</h4>
					<p>{{user_p.total_questions}}</p>
				</div>
			</div>
			<div class="card bg-inner">
				<div class="card-body">
					<h4>Respostas</h4>
					<p>{{user_p.total_responses}}</p>
				</div>
			</div>
			<div class="card bg-inner">
				<div class="card-body">
					<h4>Pontos</h4>
					<p>{{user_p.total_points}}</p>
				</div>
			</div>
		</div>

		{% if user_p.user.username != user.username %}
		<style>
			#block-div {
				margin: 1%;
			}
		</style>

		<center id="block-div">
			<!--<button id="block-button" class="btn btn-outline-info" onclick="block_user()">{{ user.username|blocked:user_p.user.username }}</button>-->
			<button id="block-button" class="btn btn-outline-info" onclick="block_user()">
				{% ablockb user.username user_p.user.username as BLOCKED %}
				{% if BLOCKED %}
					Bloqueado
				{% else %}
					Bloquear
				{% endif %}
			</button>
		</center>

		<script>
			function block_user() {
				button = document.getElementById('block-button')
				button.disabled = true
				$.ajax({
					type: 'get',
					url: '/user/{{ user_p.user.username }}/block',
					complete: function(data) {
						if(data.responseText == 'Bloqueado') {
							button.innerHTML = 'Bloqueado'
						} else
							button.innerHTML = 'Bloquear'
						button.disabled = false
					}
				})
			}
		</script>
		{% endif %}</div></div>

		{% if user_p.user.username == user.username %}
		<div id="edit-profile"><a href="/user/{{ user.username }}/edit">Editar perfil</a></div>
		{% else %}
		<br>
		{% endif %}
		{% if user_p.user.username == user.username or not user_p.hide_activity %}
		<ul class="nav nav-tabs" id="tabs">
			<li class="nav-item">
				<a class="nav-link bg-main-tab activity-tab active"  id="questions">Perguntas</a>
			</li>
			<li class="nav-item">
				<a class="nav-link bg-main-tab activity-tab disabled" id="responses">Respostas</a>
			</li>
		</ul>
		<section id="questions-section">
			<div class="questions-card card bg-main">
				<ul class="list-group list-group-flush" id="qs">
					{% for question in questions %}
					<li class="list-group-item bg-main">
						<div class="question card-body">
							<a href="/question/{{ question.id }}">{{ question.text }}</a><br>
							<span style="color: #888; font-size: 80%;">Perguntada em: {{ question.pub_date|naturalday }}</span>
							{% if question.best_answer == None and user_p.user.username == user.username %}
								<br><span style="color: #888; font-size: 80%;">Sem melhor resposta</span>
							{% endif %}
						</div>
					</li>
					{% endfor %}
				</ul>
				<button class="btn btn-outline-primary" onclick="show_more_questions(this, {{ user_p.user.id }})">mais</button>
			</div>
		</section>

		<section id="responses-section">
			<div class="responses-card card bg-main">
				<ul class="list-group list-group-flush" id="rs">
					{% for response in responses %}
					<li class="list-group-item bg-main">
						<div class="response card-body">
							<a href="/question/{{ response.question.id }}">{{ response.question.text }}</a><br>
							<p>
								{% if response.question.best_answer == response.id %}
									<span class="badge badge-pill badge-primary">üèÜ Melhor resposta</span>
								{% endif %}
								{{ response.text }}
							</p>
							<span style="color: #888; font-size: 80%;">Perguntada por <a href="/user/{{response.question.creator}}">{{response.question.creator}}</a> {{ response.question.get_naturaltime }}</span>
						</div>
					</li>
					{% endfor %}
				</ul>
				<button class="btn btn-outline-primary" onclick="show_more_responses(this, {{ user_p.user.id }})">mais</button>
			</div>
		</section>

		{% endif %}
		</main><script src="/static/js/profile.js?v=4"></script>
		<script>
if (getDarkCookie() == 'true') {
	document.getElementsByClassName('navbar')[0].classList.remove("navbar-light");
	document.getElementsByClassName('navbar')[0].classList.add("navbar-dark");
}
		</script>
	</body>
</html>
