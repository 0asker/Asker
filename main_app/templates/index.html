{% spaceless %}
{% load humanize %}
{% load main_app_extras %}
<!doctype html>
<html lang="pt-br">
<head>
<title>Asker | Página inicial</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style id="wait">
	body {
		visibility: hidden;
		opacity: 0;
	}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
<script src="/static/js/cookieman.js?v=1"></script>
<script>
	var cssfn = 'index.css';
	var cssversion = '?v=11';
	if (getDarkCookie() == 'true') { cssfn = 'index-d.css'; }
	var link = document.createElement('link');
	link.rel = 'stylesheet';
	link.type = 'text/css';
	link.href = '/static/css/' + cssfn + cssversion;
	document.head.appendChild(link);

	document.getElementById('wait').remove();
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/1f965a8b94.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/shortcuts/infinite.min.js"></script>
</head>

	<body>
	{% include "includes/navbar.html" %}
	{{ account_verification_alert|safe }}
		<ul class="nav nav-tabs" id="tabs">
			<li class="nav-item">
				<span class="nav-link main-tab bg-main-tab" id="popular">Popular</span>
			</li>
			<li class="nav-item">
				<span class="nav-link main-tab bg-main-tab" id="news">Novas perguntas</span>
			</li>
			<li style="flex-grow: 1;">
				<a data-pjax style="float: right;" href="/pjax-questions"><img src="/static/images/reload.png" id="reload"></a>
			</li>
		</ul>
<!-- Questões recentes -->
<section class="card bg-main" id="n_questions">
{% include "base/recent-questions-pjax.html" %}
</section>
<!-- !Questões recentes -->

<!-- Questões populares -->
<section class="card bg-main" id="p_questions">
	<ul class="list-group list-group-flush infinite-container">
		{% for question in popular_questions %}
		<li class="list-group-item bg-main">
			<div class="card-body">

        <a href="/question/{{ question.id }}">
          <p>
            {{ question.text }}
          </p>
        </a>
        
					{% if question.description != '' %}
            <p>
              {{ question.description|cut_description|safe|linebreaksbr }}
            </p>
          {% endif %}
				<small>{% total_answers question.id %} respostas <b>&middot; </b> <span class="text-muted"><img src="/static/images/white-heart.png?version=3" width="15px"> {{ question.total_likes }}</span></small>&nbsp;|&nbsp;<small>{% question_total_views question.id %} visualizações</small>
				{% if user.is_authenticated %}
					{% answered user.username question.id as ANSWERED %}
					{% if ANSWERED %}
				<span style="display: block"><b>Sua resposta:</b></span> {% answer user.username question.id %}
					{% else %}
				<a style="display: block" href="/question/{{ question.id }}"><button class="btn btn-outline-primary">Responder</button></a>
					{% endif %}
				{% else %}
				<p><a href="/signin?redirect=/question/{{ question.id }}">Faça login</a> ou <a href="/signup?redirect=/question/{{ question.id }}">crie uma conta</a> para responder está pergunta.</p>
			{% endif %}
			</div>
		</li>
		{% endfor %}
	</ul>
	<h5>Fim! <a href="/news">Clique aqui</a> para ver as novas perguntas.</h5>
</section>
<!-- !Questões populares -->

<!-- PJAX -->
<script src="/static/js/jquery-pjax/jquery.pjax.js"></script>
<script>
	$(document).pjax('[data-pjax] a, a[data-pjax]', '#n_questions', {push: false, timeout: 10000})
	$('#n_questions').on('pjax:start', function() {
		/* Muda para a aba de perguntas recentes. */
		news.classList.add('active')
		popular.classList.remove('active')
		window.history.pushState("object or string", "Title", "/news");
		logo.href = '/news'
		p_tab.style.display = 'none'
		n_tab.style.display = 'block'

		document.getElementById('reload').classList.add('spinner');
		document.getElementById('n_questions').style.opacity = 0.5;
		document.getElementById('reload').onclick = function () { return false; }
	})
	.on('pjax:end',   function() {
		document.getElementById('reload').classList.remove('spinner');
		document.getElementById('n_questions').style.opacity = 1;
		document.getElementById('reload').onclick = function () { return true; }

	});
</script>
<!-- !PJAX -->

		<script src="/static/js/index.js?v=9"></script>
		<script>
if (getDarkCookie() == 'true') {
	document.getElementsByClassName('navbar')[0].classList.remove("navbar-light");
	document.getElementsByClassName('navbar')[0].classList.add("navbar-dark");
}
		</script>
	</body>
</html>
{% endspaceless %}
