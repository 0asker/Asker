{% load humanize %}
{% load main_app_extras %}
<!doctype html>
<html lang="pt-br">
<head>
<title>Asker | Página inicial</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style id="wait">
	body {
		visibility: hidden;
		opacity: 0;
	}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/common.css?v=3">
<script src="/static/js/cookieman.js?v=1"></script>
<script>
	var cssfn = 'light.css';
	var cssversion = '?v=3';
	if (getDarkCookie() == 'true') { cssfn = 'dark.css'; }
	var link = document.createElement('link');
	link.rel = 'stylesheet';
	link.type = 'text/css';
	link.href = '/static/css/' + cssfn + cssversion;
	document.head.appendChild(link);

	document.getElementById('wait').remove();
</script>

<style>
.popular-question-img {
	display: block;
	max-width: 60%;
	margin: auto;
}

@media (min-width: 320px) and (max-width: 480px) {
	.popular-question-img {
		max-width: 90%;
	}
}
</style>

</head>

	<body>
	{% include "includes/navbar.html" %}
	{{ account_verification_alert|safe }}
	<main>
		
		{% if request.META.HTTP_HOST == "asker.pythonanywhere.com" %}
			<div class="alert alert-success">
				<div class="alert-heading">
					<h3>Aviso!</h3>
				</div>
				<p>O Asker está agora disponível no domínio <a href="https://br.asker.fun">br.asker.fun</a>. Ou, mais fácil: <a href="http://asker.fun">asker.fun</a></p>
			</div>
		{% endif %}
		
		<ul class="nav nav-tabs" id="tabs">
			<li class="nav-item">
				<span class="nav-link main-tab bg-main-tab" id="popular">Popular</span>
			</li>
			<li class="nav-item">
				<span class="nav-link main-tab bg-main-tab" id="news">Novas perguntas</span>
			</li>
		</ul>
<!-- Questões recentes -->
<section class="card bg-main" id="n_questions">
{% include "base/recent-questions-pjax.html" %}
</section>
<!-- !Questões recentes -->

<!-- Questões populares -->
<section class="card bg-main" id="p_questions">
	<ul class="list-group list-group-flush infinite-container" id="popular-questions-ul">
		{% include "base/popular-question.html" %}
	</ul>
	<button class="btn btn-outline-primary btn-sm" onclick="show_more_popular_questions(this)">Carregar mais</button>
	<img src="/static/images/loading.gif" id="loading_popular_questions-icon" width="6%" style="display: none">
</section>
<!-- !Questões populares -->
	</main>

		<script src="/static/js/index.js?v=9"></script>
		<script>
if (getDarkCookie() == 'true') {
	document.getElementsByClassName('navbar')[0].classList.remove("navbar-light");
	document.getElementsByClassName('navbar')[0].classList.add("navbar-dark");
}
		</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://kit.fontawesome.com/1f965a8b94.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

<!-- Info Links ads -->
<script type="text/javascript"> var infolinks_pid = 3334159; var infolinks_wsid = 0; </script> <script type="text/javascript" src="//resources.infolinks.com/js/infolinks_main.js"></script>
<!-- !Info Links ads -->

<script>
	/* Carrega mais questões populares. */
	next_popular_questions_page = 2; /* próxima página a ser pega das questões populares. É incrementado a cada AJAX. */
	function show_more_popular_questions(load_more_button) {
		load_more_button.style.display = "none";
		document.getElementById("loading_popular_questions-icon").style.display = "inline";
		$.ajax({
			url: "get-popular-questions",
			data: {
				"popular_page": next_popular_questions_page,
			},
			complete: function(data) {
				
				if (data.responseText == "EmptyPage") {
					load_more_button.remove();
					
					html = `
<br><p align="center"><i class="far fa-sad-cry"></i> Fim! Veja as novas perguntas <a href="/news">aqui.</a></p>
`
					
					document.getElementById("p_questions").innerHTML += html;
				} else {
					document.getElementById("popular-questions-ul").innerHTML += data.responseText;
				}
				
				next_popular_questions_page++;
				load_more_button.style.display = "inline-block";
				document.getElementById("loading_popular_questions-icon").style.display = "none";
			}
		});
	}
</script>

	</body>
</html>
